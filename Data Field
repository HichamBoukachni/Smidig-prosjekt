import sys
from PyQt5.QtWidgets import (QApplication, QMainWindow, QVBoxLayout, QHBoxLayout, QPushButton,
                             QProgressBar, QComboBox, QWidget, QLabel, QTreeWidget, QTreeWidgetItem, 
                             QLineEdit, QFileDialog)
from PyQt5.QtGui import QIcon, QPixmap
from PyQt5.QtCore import Qt, QSize

class VolatilityPluginViewer(QWidget):
    def __init__(self):
        super().__init__()

        # Initialize the main widget and layout
        self.layout = QVBoxLayout(self)

        # Initialize the QTreeWidget
        self.plugins_list = QTreeWidget(self)
        self.plugins_list.setHeaderHidden(True)
        self.layout.addWidget(self.plugins_list)

        # Populate the tree with plugins
        self.populate_plugins()
        self.plugins_list.itemClicked.connect(self.toggle_heart)

    def populate_plugins(self):
        categories = {
            "Processes and Threads": ["pslist", "psscan", "threads", "ldrmodules"],
            "Linux Plugins": ["bash.Bash", "capabilities.Capabilities", "check_afinfo.Check_afinfo", 
                              "check_creds.Check_creds", "check_idt.Check_idt", "check_modules.Check_modules", 
                              "check_syscall.Check_syscall", "elfs.Elfs", "envars.Envars", "iomem.IOMem", 
                              "keyboard_notifiers.Keyboard_notifiers", "kmsg.Kmsg", "library_list.LibraryList", 
                              "lsmod.Lsmod", "lsof.Lsof", "malfind.Malfind", "mountinfo.MountInfo", "proc.Maps", 
                              "psaux.PsAux", "pslist.PsList", "psscan.PsScan", "pstree.PsTree", "sockstat.Sockstat", 
                              "tty_check.tty_check", "vmayarascan.VmaYaraScan"],
            "Mac Plugins": ["bash.Bash", "check_syscall.Check_syscall", "check_sysctl.Check_sysctl", 
                            "check_trap_table.Check_trap_table", "dmesg.Dmesg", "ifconfig.Ifconfig", 
                            "kauth_listeners.Kauth_listeners", "kauth_scopes.Kauth_scopes", "kevents.Kevents", 
                            "list_files.List_Files", "lsmod.Lsmod", "lsof.Lsof", "malfind.Malfind", "mount.Mount", 
                            "netstat.Netstat", "proc_maps.Maps", "psaux.Psaux", "pslist.PsList", "pstree.PsTree", 
                            "socket_filters.Socket_filters", "timers.Timers", "trustedbsd.Trustedbsd", "vfsevents.VFSevents"],
            "Windows Plugins": ["bigpools.BigPools", "cachedump.Cachedump", "callbacks.Callbacks", "cmdline.CmdLine", 
                                "crashinfo.Crashinfo", "devicetree.DeviceTree", "dlllist.DllList", "driverirp.DriverIrp", 
                                "drivermodule.DriverModule", "driverscan.DriverScan", "dumpfiles.DumpFiles", "envars.Envars", 
                                "filescan.FileScan", "getservicesids.GetServiceSIDs", "getsids.GetSIDs", "handles.Handles", 
                                "hashdump.Hashdump", "iat.IAT", "info.Info", "joblinks.JobLinks", "ldrmodules.LdrModules", 
                                "lsadump.Lsadump", "malfind.Malfind", "mbrscan.MBRScan", "memmap.Memmap", "mftscan.ADS", 
                                "mftscan.MFTScan", "modscan.ModScan", "modules.Modules", "mutantscan.MutantScan", "netscan.NetScan", 
                                "netstat.NetStat", "poolscanner.PoolScanner", "privileges.Privs", "pslist.PsList", "psscan.PsScan", 
                                "pstree.PsTree", "registry.certificates.Certificates", "registry.hivelist.HiveList", "registry.hivescan.HiveScan", 
                                "registry.printkey.PrintKey", "registry.userassist.UserAssist", "sessions.Sessions", 
                                "skeleton_key_check.Skeleton_Key_Check", "ssdt.SSDT", "statistics.Statistics", "strings.Strings", 
                                "svcscan.SvcScan", "symlinkscan.SymlinkScan", "thrdscan.ThrdScan", "truecrypt.Passphrase", "vadinfo.VadInfo", 
                                "vadwalk.VadWalk", "vadyarascan.VadYaraScan", "verinfo.VerInfo", "virtmap.VirtMap"],
            "Misc Plugins": ["banners.Banners", "configwriter.ConfigWriter", "frameworkinfo.FrameworkInfo", "isfinfo.IsfInfo", 
                             "layerwriter.LayerWriter", "timeliner.Timeliner", "yarascan.YaraScan"],
            "File system": ["filescan", "dumpfiles", "envars"],
            "Network": ["netscan", "connections", "sockets"],
            "Registry": ["printkey", "hivelist", "userassist"],
            "Memory and Handles": ["handles", "dlllist", "malfind"],
            "System Information": ["imageinfo", "kdbgscan", "info"]
        }

        for category, sub_items in categories.items():
            category_item = QTreeWidgetItem(self.plugins_list)
            category_item.setText(0, category)
            for sub_item in sub_items:
                child_item = QTreeWidgetItem(category_item)
                child_item.setText(0, "ü§ç " + sub_item)

    def set_hearted(self, item, hearted):
        text = item.text(0)
        if hearted:
            item.setText(0, "üß° " + text.replace("ü§ç", "").strip())
        else:
            item.setText(0, "ü§ç " + text.replace("üß°", "").strip())

    def toggle_heart(self, item, column):
        parent = item.parent()
        if parent is not None:  # Only toggle heart for sub-items
            text = item.text(0)
            if "üß°" in text:
                self.set_hearted(item, False)
            else:
                self.set_hearted(item, True)

class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()

        self.setWindowTitle("Data Field")
        self.setGeometry(100, 100, 1200, 800)

        self.central_widget = QWidget()
        self.setCentralWidget(self.central_widget)

        self.main_layout = QHBoxLayout(self.central_widget)

        # Left sidebar layout
        self.sidebar_layout = QVBoxLayout()
        self.sidebar_layout.setAlignment(Qt.AlignTop)
        self.main_layout.addLayout(self.sidebar_layout, 1)

        # Search bar
        self.search_layout = QHBoxLayout()
        self.search_icon = QLabel(self)
        search_pixmap = QPixmap(32, 32)
        search_pixmap.fill(Qt.white)  # Placeholder for actual search icon
        self.search_icon.setPixmap(search_pixmap)
        self.search_layout.addWidget(self.search_icon)
        self.search_bar = QLineEdit(self)
        self.search_bar.setPlaceholderText("Search")
        self.search_layout.addWidget(self.search_bar)
        self.sidebar_layout.addLayout(self.search_layout)

        # Combobox for Favorites and Categories
        self.favorites_combobox = QComboBox(self)
        self.favorites_combobox.addItem("Favorites")
        self.sidebar_layout.addWidget(self.favorites_combobox)

        # Plugins list
        self.plugins_list = VolatilityPluginViewer()
        self.sidebar_layout.addWidget(self.plugins_list)

        # Main content area
        self.content_layout = QVBoxLayout()
        self.main_layout.addLayout(self.content_layout, 4)

        # Progress Bar
        self.progress_bar_layout = QHBoxLayout()
        self.progress_bar = QProgressBar(self)
        self.progress_bar.setValue(40)  # Example progress
        self.progress_bar_layout.addWidget(self.progress_bar)

        # Control buttons next to progress bar
        self.view_result_button = QPushButton("View Result", self)
        self.progress_bar_layout.addWidget(self.view_result_button)

        # Adding play, pause, and stop buttons with icons
        icon_size = 24
        self.play_button = QPushButton(self)
        self.play_button.setIcon(QIcon(QPixmap(icon_size, icon_size)))
        self.progress_bar_layout.addWidget(self.play_button)

        self.pause_button = QPushButton(self)
        self.pause_button.setIcon(QIcon(QPixmap(icon_size, icon_size)))
        self.progress_bar_layout.addWidget(self.pause_button)

        self.stop_button = QPushButton(self)
        self.stop_button.setIcon(QIcon(QPixmap(icon_size, icon_size)))
        self.progress_bar_layout.addWidget(self.stop_button)

        self.content_layout.addLayout(self.progress_bar_layout)

        # Placeholder Area
        self.placeholder = QLabel(self)
        self.placeholder.setAlignment(Qt.AlignCenter)
        self.placeholder.setText("")
        self.content_layout.addWidget(self.placeholder, alignment=Qt.AlignCenter)

        # Placeholder Image/Icon Button
        self.upload_button = QPushButton(self)
        self.upload_button.setIcon(QIcon(r'C:\Users\Sambo\OneDrive\Documents\Data Field\plugin1..jpg'))
        self.upload_button.setIconSize(QSize(192, 192))  # Making the icon three times larger
        self.upload_button.setFlat(True)
        self.upload_button.clicked.connect(self.open_file_dialog)
        self.placeholder_layout = QVBoxLayout(self.placeholder)
        self.placeholder_layout.addWidget(self.upload_button, alignment=Qt.AlignCenter)

        # Set placeholder size
        self.placeholder.setFixedHeight(self.height() - self.progress_bar.height() - 20)
        self.placeholder.setFixedWidth(self.width() - self.sidebar_layout.sizeHint().width() - 20)

        # Styling
        self.setStyleSheet("""
            QMainWindow {
                background-color: #2b2b2b;
            }
            QLabel {
                color: white;
            }
            QComboBox, QLineEdit {
                color: white;
                background-color: #333;
            }
            QPushButton {
                background-color: #444;
                color: white;
                border: none;
                padding: 10px;
            }
            QPushButton:hover {
                background-color: #555;
            }
            QProgressBar {
                background-color: #444;
                color: white;
                text-align: center;
            }
            QTreeWidget {
                background-color: #333;
                color: white;
                border: none;
            }
            QTreeWidget::item {
                padding: 5px;
            }
            QTreeWidget::item:selected {
                background-color: #555;
                color: white;
            }
        """)

    def open_file_dialog(self):
        file_dialog = QFileDialog()
        file_dialog.setFileMode(QFileDialog.AnyFile)
        file_dialog.setViewMode(QFileDialog.Detail)
        if file_dialog.exec_():
            file_path = file_dialog.selectedFiles()[0]
            print(f"Selected file: {file_path}")

if __name__ == "__main__":
    app = QApplication(sys.argv)
    window = MainWindow()
    window.show()
    sys.exit(app.exec_())

