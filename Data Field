import sys
from PyQt5.QtWidgets import (QApplication, QMainWindow, QVBoxLayout, QHBoxLayout, QPushButton,
                             QProgressBar, QComboBox, QWidget, QLabel, QTreeWidget, QTreeWidgetItem, QLineEdit, QFileDialog)
from PyQt5.QtGui import QIcon, QPixmap
from PyQt5.QtCore import Qt, QSize

class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()

        self.setWindowTitle("Data Field")
        self.setGeometry(100, 100, 1200, 800)

        self.central_widget = QWidget()
        self.setCentralWidget(self.central_widget)

        self.main_layout = QHBoxLayout(self.central_widget)

        # Left sidebar layout
        self.sidebar_layout = QVBoxLayout()
        self.sidebar_layout.setAlignment(Qt.AlignTop)
        self.main_layout.addLayout(self.sidebar_layout, 1)

        # Search bar
        self.search_layout = QHBoxLayout()
        self.search_icon = QLabel(self)
        search_pixmap = QPixmap(32, 32)
        search_pixmap.fill(Qt.white)  # Placeholder for actual search icon
        self.search_icon.setPixmap(search_pixmap)
        self.search_layout.addWidget(self.search_icon)
        self.search_bar = QLineEdit(self)
        self.search_bar.setPlaceholderText("Search")
        self.search_layout.addWidget(self.search_bar)
        self.sidebar_layout.addLayout(self.search_layout)

        # Combobox for Favorites and Categories
        self.favorites_combobox = QComboBox(self)
        self.favorites_combobox.addItem("Favorites")
        self.sidebar_layout.addWidget(self.favorites_combobox)

        # Plugins list
        self.plugins_list = QTreeWidget(self)
        self.plugins_list.setHeaderHidden(True)
        self.sidebar_layout.addWidget(self.plugins_list)

        self.processes_item = QTreeWidgetItem(self.plugins_list)
        self.processes_item.setText(0, "Processes and Threads")

        for sub_item in ["pslist", "psscan", "threads", "ldrmodules"]:
            child_item = QTreeWidgetItem(self.processes_item)
            child_item.setText(0, "ü§ç " + sub_item)

        self.file_system_item = QTreeWidgetItem(self.plugins_list)
        self.file_system_item.setText(0, "File system")

        for sub_item in ["filescan", "dumpfiles", "envars"]:
            child_item = QTreeWidgetItem(self.file_system_item)
            child_item.setText(0, "ü§ç " + sub_item)

        self.network_item = QTreeWidgetItem(self.plugins_list)
        self.network_item.setText(0, "Network")

        for sub_item in ["netscan", "connections", "sockets"]:
            child_item = QTreeWidgetItem(self.network_item)
            child_item.setText(0, "ü§ç " + sub_item)

        self.registry_item = QTreeWidgetItem(self.plugins_list)
        self.registry_item.setText(0, "Registry")

        for sub_item in ["printkey", "hivelist", "userassist"]:
            child_item = QTreeWidgetItem(self.registry_item)
            child_item.setText(0, "ü§ç " + sub_item)

        self.memory_item = QTreeWidgetItem(self.plugins_list)
        self.memory_item.setText(0, "Memory and Handles")

        for sub_item in ["handles", "dlllist", "malfind"]:
            child_item = QTreeWidgetItem(self.memory_item)
            child_item.setText(0, "ü§ç " + sub_item)

        self.system_info_item = QTreeWidgetItem(self.plugins_list)
        self.system_info_item.setText(0, "System Information")

        for sub_item in ["imageinfo", "kdbgscan", "info"]:
            child_item = QTreeWidgetItem(self.system_info_item)
            child_item.setText(0, "ü§ç " + sub_item)

        self.plugins_list.itemClicked.connect(self.toggle_heart)

        # Main content area
        self.content_layout = QVBoxLayout()
        self.main_layout.addLayout(self.content_layout, 4)

        # Progress Bar
        self.progress_bar_layout = QHBoxLayout()
        self.progress_bar = QProgressBar(self)
        self.progress_bar.setValue(40)  # Example progress
        self.progress_bar_layout.addWidget(self.progress_bar)

        # Control buttons next to progress bar
        self.view_result_button = QPushButton("View Result", self)
        self.progress_bar_layout.addWidget(self.view_result_button)

        # Adding play, pause, and stop buttons with icons
        icon_size = 24
        self.play_button = QPushButton(self)
        self.play_button.setIcon(QIcon(QPixmap(icon_size, icon_size)))
        self.progress_bar_layout.addWidget(self.play_button)

        self.pause_button = QPushButton(self)
        self.pause_button.setIcon(QIcon(QPixmap(icon_size, icon_size)))
        self.progress_bar_layout.addWidget(self.pause_button)

        self.stop_button = QPushButton(self)
        self.stop_button.setIcon(QIcon(QPixmap(icon_size, icon_size)))
        self.progress_bar_layout.addWidget(self.stop_button)

        self.content_layout.addLayout(self.progress_bar_layout)

        # Placeholder Area
        self.placeholder = QLabel(self)
        self.placeholder.setAlignment(Qt.AlignCenter)
        self.placeholder.setText("")
        self.content_layout.addWidget(self.placeholder, alignment=Qt.AlignCenter)

        # Placeholder Image/Icon Button
        self.upload_button = QPushButton(self)
        self.upload_button.setIcon(QIcon(r'C:\Users\hicha\Downloads\Upload orange.png'))
        self.upload_button.setIconSize(QSize(192, 192))  # Making the icon three times larger
        self.upload_button.setFlat(True)
        self.upload_button.clicked.connect(self.open_file_dialog)
        self.placeholder_layout = QVBoxLayout(self.placeholder)
        self.placeholder_layout.addWidget(self.upload_button, alignment=Qt.AlignCenter)

        # Set placeholder size
        self.placeholder.setFixedHeight(self.height() - self.progress_bar.height() - 20)
        self.placeholder.setFixedWidth(self.width() - self.sidebar_layout.sizeHint().width() - 20)

        # Styling
        self.setStyleSheet("""
            QMainWindow {
                background-color: #2b2b2b;
            }
            QLabel {
                color: white;
            }
            QComboBox, QLineEdit {
                color: white;
                background-color: #333;
            }
            QPushButton {
                background-color: #444;
                color: white;
                border: none;
                padding: 10px;
            }
            QPushButton:hover {
                background-color: #555;
            }
            QProgressBar {
                background-color: #444;
                color: white;
                text-align: center;
            }
            QTreeWidget {
                background-color: #333;
                color: white;
                border: none;
            }
            QTreeWidget::item {
                padding: 5px;
            }
            QTreeWidget::item:selected {
                background-color: #555;
                color: white;
            }
        """)

    def set_hearted(self, item, hearted):
        text = item.text(0)
        if hearted:
            item.setText(0, "üß° " + text.replace("ü§ç", "").strip())
        else:
            item.setText(0, "ü§ç " + text.replace("üß°", "").strip())

    def toggle_heart(self, item, column):
        parent = item.parent()
        if parent is not None:  # Only toggle heart for sub-items
            text = item.text(0)
            if "üß°" in text:
                self.set_hearted(item, False)
            else:
                self.set_hearted(item, True)

    def open_file_dialog(self):
        file_dialog = QFileDialog()
        file_dialog.setFileMode(QFileDialog.AnyFile)
        file_dialog.setViewMode(QFileDialog.Detail)
        if file_dialog.exec_():
            file_path = file_dialog.selectedFiles()[0]
            print(f"Selected file: {file_path}")

if __name__ == "__main__":
    app = QApplication(sys.argv)
    window = MainWindow()
    window.show()
    sys.exit(app.exec_())
